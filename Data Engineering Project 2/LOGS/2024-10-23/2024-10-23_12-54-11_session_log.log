2024-10-23 12:54:11,527 - INFO - Created new session log file.
2024-10-23 12:54:11,529 - INFO - ##################################################
2024-10-23 12:54:11,529 - INFO - STEP 1 : Extarcting data from kagggle
2024-10-23 12:54:11,529 - INFO - ##################################################
2024-10-23 12:54:11,529 - INFO - Starting data download...
2024-10-23 12:54:13,681 - INFO - Files in the zip archive: ['Credit card transactions - India - Simple.csv']
2024-10-23 12:54:13,681 - INFO - Processing the data in chunks...
2024-10-23 12:54:13,706 - INFO - Processed 10000 rows of data.
2024-10-23 12:54:13,729 - INFO - Processed 10000 rows of data.
2024-10-23 12:54:13,745 - INFO - Processed 6052 rows of data.
2024-10-23 12:54:13,831 - INFO - Data processing and transmission to NiFi completed successfully.
2024-10-23 12:54:19,085 - INFO - Appending to existing log file.
2024-10-23 12:54:19,199 - INFO - ##################################################
2024-10-23 12:54:19,199 - INFO - STEP 2 : Pushing the data to table
2024-10-23 12:54:19,199 - INFO - ##################################################
2024-10-23 12:54:19,226 - INFO - Table 'transactions' created.
2024-10-23 12:54:37,462 - INFO - Data processing completed successfully. Total records pushed: 26052.
2024-10-23 12:55:58,950 - INFO - Appending to existing log file.
2024-10-23 12:55:58,950 - INFO - ##################################################
2024-10-23 12:55:58,950 - INFO - STEP 3 : Creating Reports
2024-10-23 12:55:58,950 - INFO - ##################################################
2024-10-23 12:55:58,950 - INFO - Establishing database connection...
2024-10-23 12:55:59,087 - INFO - Database connection established successfully.
2024-10-23 12:55:59,087 - INFO - SQL filename: Average Spend Per Transaction by Card Type.sql
2024-10-23 12:55:59,088 - INFO - SQL query read from file: SELECT 
    card_type, 
    YEAR(transaction_date) AS transaction_year,
    MONTH(transaction_date) AS transaction_month,
    AVG(amount) AS average_spend_per_transaction
FROM 
    transactions
GROUP BY 
    card_type, 
    YEAR(transaction_date),
    MONTH(transaction_date);
2024-10-23 12:55:59,284 - INFO - SQL query executed successfully. Retrieved 80 rows.
2024-10-23 12:55:59,291 - INFO - Cursor closed.
2024-10-23 12:55:59,292 - INFO - Database connection closed.
2024-10-23 12:56:10,355 - INFO - Appending to existing log file.
2024-10-23 12:56:10,356 - INFO - ##################################################
2024-10-23 12:56:10,356 - INFO - STEP 3 : Creating Reports
2024-10-23 12:56:10,356 - INFO - ##################################################
2024-10-23 12:56:10,356 - INFO - Establishing database connection...
2024-10-23 12:56:10,467 - INFO - Database connection established successfully.
2024-10-23 12:56:10,468 - INFO - SQL filename: Cumulative Spend by City.sql
2024-10-23 12:56:10,468 - INFO - SQL query read from file: WITH CumulativeSpending AS (
    SELECT 
        city,
        transaction_date,
        SUM(amount) OVER (PARTITION BY city ORDER BY transaction_date) AS cumulative_spend
    FROM 
        transactions
)
SELECT 
    city,
    MIN(transaction_date) AS first_date_to_reach_500k
FROM 
    CumulativeSpending
WHERE 
    cumulative_spend >= 500000
GROUP BY 
    city;

2024-10-23 12:56:11,363 - INFO - SQL query executed successfully. Retrieved 796 rows.
2024-10-23 12:56:11,370 - INFO - Cursor closed.
2024-10-23 12:56:11,371 - INFO - Database connection closed.
2024-10-23 12:56:17,509 - INFO - Appending to existing log file.
2024-10-23 12:56:17,510 - INFO - ##################################################
2024-10-23 12:56:17,510 - INFO - STEP 3 : Creating Reports
2024-10-23 12:56:17,510 - INFO - ##################################################
2024-10-23 12:56:17,510 - INFO - Establishing database connection...
2024-10-23 12:56:17,553 - INFO - Database connection established successfully.
2024-10-23 12:56:17,554 - INFO - SQL filename: Fastest Growth in Spending.sql
2024-10-23 12:56:17,554 - INFO - SQL query read from file: WITH TransactionCounts AS (
    SELECT 
        card_type,
        COUNT(*) AS transaction_count,
        SUM(amount) AS total_spend
    FROM 
        transactions
    GROUP BY 
        card_type
)
SELECT TOP 1 
    card_type,
    transaction_count,
    total_spend,
    (total_spend * 1.0 / transaction_count) AS average_spend_per_transaction
FROM 
    TransactionCounts
ORDER BY 
    average_spend_per_transaction DESC;

2024-10-23 12:56:17,620 - INFO - SQL query executed successfully. Retrieved 1 rows.
2024-10-23 12:56:17,625 - INFO - Cursor closed.
2024-10-23 12:56:17,626 - INFO - Database connection closed.
2024-10-23 12:56:20,468 - INFO - Appending to existing log file.
2024-10-23 12:56:20,469 - INFO - ##################################################
2024-10-23 12:56:20,469 - INFO - STEP 3 : Creating Reports
2024-10-23 12:56:20,469 - INFO - ##################################################
2024-10-23 12:56:20,469 - INFO - Establishing database connection...
2024-10-23 12:56:20,512 - INFO - Database connection established successfully.
2024-10-23 12:56:20,526 - INFO - SQL filename: Highest Spending Gender.sql
2024-10-23 12:56:20,526 - INFO - SQL query read from file: SELECT 
    city,
    gender,
    SUM(amount) AS total_spend
FROM 
    transactions
GROUP BY 
    city, 
    gender
ORDER BY 
    city, 
    total_spend DESC;

2024-10-23 12:56:20,648 - INFO - SQL query executed successfully. Retrieved 1876 rows.
2024-10-23 12:56:20,659 - INFO - Cursor closed.
2024-10-23 12:56:20,660 - INFO - Database connection closed.
2024-10-23 12:56:23,141 - INFO - Appending to existing log file.
2024-10-23 12:56:23,141 - INFO - ##################################################
2024-10-23 12:56:23,141 - INFO - STEP 3 : Creating Reports
2024-10-23 12:56:23,142 - INFO - ##################################################
2024-10-23 12:56:23,142 - INFO - Establishing database connection...
2024-10-23 12:56:23,180 - INFO - Database connection established successfully.
2024-10-23 12:56:23,180 - INFO - SQL filename: Spend by Gender Across Cities.sql
2024-10-23 12:56:23,181 - INFO - SQL query read from file: SELECT 
    city,
    gender,
    SUM(amount) AS total_spend,
    (SUM(amount) * 100.0 / (SELECT SUM(amount) FROM transactions WHERE city = ct.city)) AS percentage_contribution
FROM 
    transactions ct
GROUP BY 
    city, 
    gender;
2024-10-23 12:56:23,296 - INFO - SQL query executed successfully. Retrieved 1876 rows.
2024-10-23 12:56:23,312 - INFO - Cursor closed.
2024-10-23 12:56:23,313 - INFO - Database connection closed.
2024-10-23 12:56:29,963 - INFO - Appending to existing log file.
2024-10-23 12:56:29,963 - INFO - ##################################################
2024-10-23 12:56:29,963 - INFO - STEP 3 : Creating Reports
2024-10-23 12:56:29,963 - INFO - ##################################################
2024-10-23 12:56:29,963 - INFO - Establishing database connection...
2024-10-23 12:56:30,026 - INFO - Database connection established successfully.
2024-10-23 12:56:30,033 - INFO - SQL filename: Spend Distribution Across Card Types.sql
2024-10-23 12:56:30,033 - INFO - SQL query read from file: SELECT 
    card_type, 
    MAX(amount) AS highest_spend_amount, 
    MIN(amount) AS lowest_spend_amount
FROM 
    transactions
GROUP BY 
    card_type;
2024-10-23 12:56:30,071 - INFO - SQL query executed successfully. Retrieved 4 rows.
2024-10-23 12:56:30,075 - INFO - Cursor closed.
2024-10-23 12:56:30,075 - INFO - Database connection closed.
2024-10-23 12:56:32,653 - INFO - Appending to existing log file.
2024-10-23 12:56:32,653 - INFO - ##################################################
2024-10-23 12:56:32,653 - INFO - STEP 3 : Creating Reports
2024-10-23 12:56:32,654 - INFO - ##################################################
2024-10-23 12:56:32,654 - INFO - Establishing database connection...
2024-10-23 12:56:32,696 - INFO - Database connection established successfully.
2024-10-23 12:56:32,703 - INFO - SQL filename: Top 5 Expense Categories.sql
2024-10-23 12:56:32,703 - INFO - SQL query read from file: 
SELECT top 5
    exp_type, 
    SUM(amount) AS total_spend,
    (SUM(amount) * 100.0 / (SELECT SUM(amount) FROM DEProject.dbo.transactions)) AS percentage_contribution
FROM 
    [transactions]
GROUP BY 
    exp_type
ORDER BY 
    total_spend DESC;
2024-10-23 12:56:32,832 - INFO - SQL query executed successfully. Retrieved 5 rows.
2024-10-23 12:56:32,838 - INFO - Cursor closed.
2024-10-23 12:56:32,839 - INFO - Database connection closed.
2024-10-23 12:56:35,632 - INFO - Appending to existing log file.
2024-10-23 12:56:35,633 - INFO - ##################################################
2024-10-23 12:56:35,633 - INFO - STEP 3 : Creating Reports
2024-10-23 12:56:35,633 - INFO - ##################################################
2024-10-23 12:56:35,633 - INFO - Establishing database connection...
2024-10-23 12:56:35,701 - INFO - Database connection established successfully.
2024-10-23 12:56:35,712 - INFO - SQL filename: Weekend vs Weekday Transaction Patterns.sql
2024-10-23 12:56:35,712 - INFO - SQL query read from file: SELECT 
    city,
    CASE 
        WHEN DATEPART(WEEKDAY, transaction_date) IN (1, 7) THEN 'Weekend'
        ELSE 'Weekday' 
    END AS day_type,
    COUNT(*) AS total_transactions,
    SUM(amount) AS total_spend
FROM 
    transactions
GROUP BY 
    city, 
    CASE 
        WHEN DATEPART(WEEKDAY, transaction_date) IN (1, 7) THEN 'Weekend'
        ELSE 'Weekday' 
    END;

2024-10-23 12:56:35,803 - INFO - SQL query executed successfully. Retrieved 1783 rows.
2024-10-23 12:56:35,815 - INFO - Cursor closed.
2024-10-23 12:56:35,816 - INFO - Database connection closed.
2024-10-23 12:56:39,454 - INFO - Appending to existing log file.
2024-10-23 12:56:39,455 - INFO - ##################################################
2024-10-23 12:56:39,455 - INFO - STEP 3 : Creating Reports
2024-10-23 12:56:39,455 - INFO - ##################################################
2024-10-23 12:56:39,455 - INFO - Establishing database connection...
2024-10-23 12:56:39,511 - INFO - Database connection established successfully.
2024-10-23 12:56:39,511 - INFO - SQL filename: Year over Year Spend Growth.sql
2024-10-23 12:56:39,511 - INFO - SQL query read from file: WITH YearlySpend AS (
    SELECT 
        city,
        card_type,
        YEAR(transaction_date) AS year,
        SUM(amount) AS total_spend
    FROM 
        transactions
    WHERE 
        YEAR(transaction_date) IN (2013, 2014)
    GROUP BY 
        city, 
        card_type, 
        YEAR(transaction_date)
)
SELECT 
    y2014.city,
    y2014.card_type,
    (y2014.total_spend - COALESCE(y2013.total_spend, 0)) AS growth
FROM 
    YearlySpend y2014
LEFT JOIN 
    YearlySpend y2013 
ON 
    y2014.city = y2013.city 
    AND y2014.card_type = y2013.card_type 
    AND y2013.year = 2013
WHERE 
    y2014.year = 2014
ORDER BY 
    growth DESC
OFFSET 0 ROWS FETCH NEXT 1 ROW ONLY; -- SQL Server syntax for LIMIT

2024-10-23 12:56:39,609 - INFO - SQL query executed successfully. Retrieved 1 rows.
2024-10-23 12:56:39,614 - INFO - Cursor closed.
2024-10-23 12:56:39,615 - INFO - Database connection closed.
